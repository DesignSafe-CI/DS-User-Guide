name: "Validate requirements"

description: |
  Reject direct edits to `requirements.txt` by humans unless there is not net change, the change is by an allowed bot, or the change uses bot-style commit message (so admin can override in a pinch).

inputs:
  allowed_bots:
    description: "Comma-separated list of allowed bot author names"
    required: false
    default: "github-actions[bot],dependabot[bot]"
  commit_message_file:
    description: "Path to file that contains canonical commit message (exact match)"
    required: false
    default: ".github/commit-messages/requirements_update.txt"

runs:
  using: "composite"
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Run requirements check
      shell: bash
      env:
        ALLOWED_BOTS: ${{ inputs.allowed_bots }}
        COMMIT_MSG_FILE: ${{ inputs.commit_message_file }}
      run: |
        bash ./.github/actions/validate-requirements/check.sh